# Notify Service

Сервис обработки уведомлений через Kafka.

## Описание

Сервис отвечает за:
- Обработку событий из Kafka
- Отправку уведомлений пользователям (email, SMS и т.д.)
- Асинхронную обработку событий заказов

## Технологии

- **Go 1.25+**
- **Kafka** - для получения событий
- **Prometheus** - метрики

## Архитектура

Сервис является Kafka consumer:

```
Kafka Consumer → Service → Notification (Email/SMS)
```

### Слои

- **Kafka Consumer** (`internal/kafka/`) - получение событий из Kafka
- **Service** (`internal/service/`) - бизнес-логика обработки уведомлений
- **Handler** (опционально) - обработка различных типов уведомлений

## API Документация

Сервис не предоставляет gRPC API, а работает как Kafka consumer.

Обрабатываемые события описаны ниже.

## Обрабатываемые события

### order_created

Событие создается в order-service при создании заказа.

**Формат события:**
```json
{
  "order_id": 1,
  "user_id": 1,
  "total_price": 599.98,
  "status": "pending"
}
```

**Действие:**
Отправляет email уведомление пользователю о создании заказа.

## Конфигурация

Переменные окружения:

- `KAFKA_BROKERS` - адреса брокеров Kafka (по умолчанию: localhost:9092)
- `KAFKA_GROUP` - группа потребителей (по умолчанию: notify-service-group)
- `EMAIL_FROM` - адрес отправителя (по умолчанию: noreply@example.com)

## Запуск

```bash
go run ./cmd/main.go
```

Метрики Prometheus доступны на порту **9006**.

## Особенности реализации

1. **Асинхронность**: Обработка событий происходит асинхронно
2. **Retry**: При ошибке отправки уведомления можно реализовать retry механизм
3. **Масштабируемость**: Можно запустить несколько экземпляров для параллельной обработки
4. **Consumer Groups**: Использует Kafka consumer groups для распределения нагрузки

## Kafka Topics

- `order_created` - событие создания заказа

## Тестирование

Для тестирования можно отправить событие в Kafka:

```bash
# Пример отправки события
kafka-console-producer --broker-list localhost:9092 --topic order_created
```

## Зависимости

- **users-service** - нет (опционально для получения email пользователя)
- **goods-service** - нет
- **order-service** - получает события от order-service
- **payment-service** - нет
- **delivery-service** - нет
- **Kafka** - обязательная зависимость

## Логирование

Используется структурированное логирование через `shared/pkg/logger`.

## Мониторинг

Метрики Prometheus доступны по адресу: `http://localhost:9006/metrics`

## Расширение функционала

Сервис можно расширить для:
- Отправки SMS уведомлений
- Push уведомлений
- Обработки других типов событий (payment_completed, delivery_started и т.д.)
- Интеграции с внешними сервисами уведомлений (SendGrid, Twilio и т.д.)

